fpath <- file.path("~", "GitHub", "Spring2018-Project1-xinrouli", "data", "InauguralSpeeches")
file.name <- dir(fpath)
file.name
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE))
}
getwd()
inaug.info <- read.csv("../data/InaugurationInfo.xlsx", stringsAsFactors = FALSE)
inaug.info <- read.table("../data/InaugurationInfo.xlsx", stringsAsFactors = FALSE)
library("xlsx")
Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre7')
install.packages("rJava")
library("rJava")
library("xlsx")
inaug.info <- read.xlsx("../data/InaugurationInfo.xlsx", stringsAsFactors = FALSE)
read.xlsx()
?read.xlsx()
inaug.info <- read.xlsx("../data/InaugurationInfo.xlsx", 1, stringsAsFactors = FALSE)
class(inaug.info)
dim(inaug.info)
head(inaug.info)
tail(inaug.info)
list.files()
list.files("../data")
?read.csv
ingu.dates <- read.table("InauguationDates.txt")
ingu.dates <- read.table("../data/InauguationDates.txt")
inaug.dates <- read.table("../data/InauguationDates.txt", header = TRUE)
file.name
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE), collapse=" ")
}
head(speech[1],5)
head(speech[1],5)
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE), collapse=" ")
}
fpath <- file.path("~", "GitHub", "Spring2018-Project1-xinrouli", "data", "InauguralSpeeches")
file.name <- dir(fpath)
speech <- c()
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE), collapse=" ")
}
file.name
dim(speech)
length(speech)
length(file.name)
inaug.speech <- data.frame(file.name, speech)
dim(inaug.speech)
head(inaug.speech)
View(inaug.speech)
View(inaug.info)
rownames(inaug.speech) <- NULL
inaug.speech$file.name <- substr(inaug.speech$file.name, start = 6, stop = nchar(inaug.speech$file.name)-4)
class
class(inaug.speech$file.name)
?data.frame
inaug.speech <- data.frame(file.name, speech, stringsAsFactors = FALSE)
rownames(inaug.speech) <- NULL
class(inaug.speech$file.name)
library(dplyr)
substr.func <- function(df){
df$file.name <- substr(df$file.name, start = 6, stop = nchar(df$file.name)-4)
}
inaug.speech$file.name <- tapply(inaug.speech, substr.func)
inaug.speech$file.name <- apply(inaug.speech, 1, substr.func)
apply(inaug.speech, 1, substr.func)
substr.func <- function(df){
df$file.name <- substr(df$file.name, start = 6, stop = nchar(df$file.name)-4)
}
substr.func <- function(df){
return(df$file.name <- substr(df$file.name, start = 6, stop = nchar(df$file.name)-4))
}
apply(inaug.speech, 1, substr.func)
inaug.speech
mode(inaug.speech)
class(inaug.speech)
inaug.speech
substr.func <- function(df){
return(df$file.name <- substr(df[1], start = 6, stop = nchar(df$file.name)-4))
}
apply(inaug.speech, 1, substr.func)
substr.func <- function(df){
return(substr(df[1], start = 6, stop = nchar(df$file.name)-4))
}
apply(inaug.speech, 1, substr.func)
substr.func <- function(df){
return(substr(df[1], start = 6, stop = nchar(df[1])-4))
}
apply(inaug.speech, 1, substr.func)
class(inaug.speech)
View(inaug.speech)
inaug.speech$file.name <- apply(inaug.speech, 1, substr.func)
paste.func <- function(df){
return(paste(df[2], "-", df[3]))
}
inaug.info[1]
inaug.info[, 1]
inaug.info[1, 1]
inaug.info$file.name <- apply(inaug.info, 1, paste.func)
paste.func <- function(df){
return(paste(df[2], "-", df[3], sep = ""))
}
inaug.info$file.name <- apply(inaug.info, 1, paste.func)
inaug <- merge(x = inaug.info, y = inaug.speech, by.x = "file.name", by.y = "file.name")
View(inaug)
inaug$speech <- strsplit(inaug$speech, split = '(\\s|[[:punct:]])+')
head(inaug$speech[1], 5)
class(inaug$speech)
class(inaug$speech[1])
class(inaug$speech[[1]])
head(inaug$speech[[1]])
head(inaug$speech[[1]], 20)
mode(inaug$speech[[1]])
mode(inaug$speech[1])
quartz
quartz()
quartz()
corpus.list=sentence.list[2:(nrow(sentence.list)-1), ]
packages.used=c("rvest", "tibble", "qdap",
"sentimentr", "gplots", "dplyr",
"tm", "syuzhet", "factoextra",
"beeswarm", "scales", "RColorBrewer",
"RANN", "tm", "topicmodels")
# check packages that need to be installed.
packages.needed=setdiff(packages.used,
intersect(installed.packages()[,1],
packages.used))
# install additional packages
if(length(packages.needed)>0){
install.packages(packages.needed, dependencies = TRUE)
}
# load packages
library("rvest")
library("tibble")
Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre7')
library("qdap")
library("sentimentr")
library("gplots")
library("dplyr")
library("tm")
library("syuzhet")
library("factoextra")
library("beeswarm")
library("scales")
library("RColorBrewer")
library("RANN")
library("tm")
library("topicmodels")
source("../lib/plotstacked.R")
source("../lib/speechFuncs.R")
print(R.version)
### Inauguaral speeches
main.page <- read_html(x = "http://www.presidency.ucsb.edu/inaugurals.php")
# Get link URLs
# f.speechlinks is a function for extracting links from the list of speeches.
inaug=f.speechlinks(main.page)
#head(inaug)
as.Date(inaug[,1], format="%B %e, %Y")
inaug=inaug[-nrow(inaug),] # remove the last line, irrelevant due to error.
#### Nomination speeches
main.page=read_html("http://www.presidency.ucsb.edu/nomination.php")
# Get link URLs
nomin <- f.speechlinks(main.page)
nomin <- nomin[-47, ]
#head(nomin)
#
#### Farewell speeches
main.page=read_html("http://www.presidency.ucsb.edu/farewell_addresses.php")
# Get link URLs
farewell <- f.speechlinks(main.page)
#head(farewell)
inaug.list=read.csv("../data/inauglist.csv", stringsAsFactors = FALSE)
nomin.list=read.csv("../data/nominlist.csv", stringsAsFactors = FALSE)
farewell.list=read.csv("../data/farewelllist.csv", stringsAsFactors = FALSE)
speech.list=rbind(inaug.list, nomin.list, farewell.list)
speech.list$type=c(rep("inaug", nrow(inaug.list)),
rep("nomin", nrow(nomin.list)),
rep("farewell", nrow(farewell.list)))
speech.url=rbind(inaug, nomin, farewell)
speech.list=cbind(speech.list, speech.url)
# Loop over each row in speech.list
speech.list$fulltext=NA
for(i in seq(nrow(speech.list))) {
text <- read_html(speech.list$urls[i]) %>% # load the page
html_nodes(".displaytext") %>% # isloate the text
html_text() # get the text
speech.list$fulltext[i]=text
# Create the file name
filename <- paste0("../data/fulltext/",
speech.list$type[i],
speech.list$File[i], "-",
speech.list$Term[i], ".txt")
sink(file = filename) %>% # open file to write
cat(text)  # write the file
sink() # close the file
}
speech1=paste(readLines("../data/fulltext/SpeechDonaldTrump-NA.txt",
n=-1, skipNul=TRUE),
collapse=" ")
speech2=paste(readLines("../data/fulltext/SpeechDonaldTrump-NA2.txt",
n=-1, skipNul=TRUE),
collapse=" ")
speech3=paste(readLines("../data/fulltext/PressDonaldTrump-NA.txt",
n=-1, skipNul=TRUE),
collapse=" ")
Trump.speeches=data.frame(
President=rep("Donald J. Trump", 3),
File=rep("DonaldJTrump", 3),
Term=rep(0, 3),
Party=rep("Republican", 3),
Date=c("August 31, 2016", "September 7, 2016", "January 11, 2017"),
Words=c(word_count(speech1), word_count(speech2), word_count(speech3)),
Win=rep("yes", 3),
type=rep("speeches", 3),
links=rep(NA, 3),
urls=rep(NA, 3),
fulltext=c(speech1, speech2, speech3)
)
names(speech.list)[names(speech.list) == "Ã¯..President"] <- "President"
speech.list=rbind(speech.list, Trump.speeches)
sentence.list=NULL
for(i in 1:nrow(speech.list)){
sentences=sent_detect(speech.list$fulltext[i],
endmarks = c("?", ".", "!", "|",";"))
if(length(sentences)>0){
emotions=get_nrc_sentiment(sentences)
word.count=word_count(sentences)
# colnames(emotions)=paste0("emo.", colnames(emotions))
# in case the word counts are zeros?
emotions=diag(1/(word.count+0.01))%*%as.matrix(emotions)
sentence.list=rbind(sentence.list,
cbind(speech.list[i,-ncol(speech.list)],
sentences=as.character(sentences),
word.count,
emotions,
sent.id=1:length(sentences)
)
)
}
}
?writeLines
writeLines('aaaaaa')
View(inaug)
# load packages
# Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre7')
library(xlsx)
library(dplyr)
#################### load dataset
# inaug.info
inaug.info <- read.xlsx("../data/InaugurationInfo.xlsx", 1, stringsAsFactors = FALSE)
# inaug.dates
inaug.dates <- read.table("../data/InauguationDates.txt", 1, stringsAsFactors = FALSE)
#################### load dataset
# inaug.info
inaug.info <- read.xlsx("../data/InaugurationInfo.xlsx", 1, stringsAsFactors = FALSE)
# inaug.dates
# inaug.dates <- read.table("../data/InauguationDates.txt", 1, stringsAsFactors = FALSE)
# inaug.speech
fpath <- file.path("~", "GitHub", "Spring2018-Project1-xinrouli", "data", "InauguralSpeeches")
file.name <- dir(fpath)
speech <- c()
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE), collapse=" ")
}
inaug.speech <- data.frame(file.name, speech, stringsAsFactors = FALSE)
rownames(inaug.speech) <- NULL
substr.func <- function(df){
return(substr(df[1], start = 6, stop = nchar(df[1])-4))
}
inaug.speech$file.name <- apply(inaug.speech, 1, substr.func)
paste.func <- function(df){
return(paste(df[2], "-", df[3], sep = ""))
}
inaug.info$file.name <- apply(inaug.info, 1, paste.func)
inaug <- merge(x = inaug.info, y = inaug.speech, by.x = "file.name", by.y = "file.name")
inaug$speech <- strsplit(inaug$speech, split = '(\\s|[[:punct:]])+')
View(inaug)
class(speech)
class(inaug$speech)
length(inaug$speech[[1]])
length(inaug$speech[[2]])
length(inaug$speech[[4]])
#################### load dataset
# inaug.info
inaug.info <- read.xlsx("../data/InaugurationInfo.xlsx", 1, stringsAsFactors = FALSE)
# inaug.dates
# inaug.dates <- read.table("../data/InauguationDates.txt", 1, stringsAsFactors = FALSE)
# inaug.speech
fpath <- file.path("~", "GitHub", "Spring2018-Project1-xinrouli", "data", "InauguralSpeeches")
file.name <- dir(fpath)
speech <- c()
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE), collapse=" ")
}
inaug.speech <- data.frame(file.name, speech, stringsAsFactors = FALSE)
rownames(inaug.speech) <- NULL
substr.func <- function(df){
return(substr(df[1], start = 6, stop = nchar(df[1])-4))
}
inaug.speech$file.name <- apply(inaug.speech, 1, substr.func)
paste.func <- function(df){
return(paste(df[2], "-", df[3], sep = ""))
}
inaug.info$file.name <- apply(inaug.info, 1, paste.func)
inaug <- merge(x = inaug.info, y = inaug.speech, by.x = "file.name", by.y = "file.name")
inaug$speech <- strsplit(inaug$speech, split = '(\\s')
rownames(inaug.speech) <- NULL
substr.func <- function(df){
return(substr(df[1], start = 6, stop = nchar(df[1])-4))
}
inaug.speech$file.name <- apply(inaug.speech, 1, substr.func)
paste.func <- function(df){
return(paste(df[2], "-", df[3], sep = ""))
}
inaug.info$file.name <- apply(inaug.info, 1, paste.func)
inaug <- merge(x = inaug.info, y = inaug.speech, by.x = "file.name", by.y = "file.name")
inaug$speech <- strsplit(inaug$speech, split = '\\s')
#################### load dataset
# inaug.info
inaug.info <- read.xlsx("../data/InaugurationInfo.xlsx", 1, stringsAsFactors = FALSE)
# inaug.dates
# inaug.dates <- read.table("../data/InauguationDates.txt", 1, stringsAsFactors = FALSE)
# inaug.speech
fpath <- file.path("~", "GitHub", "Spring2018-Project1-xinrouli", "data", "InauguralSpeeches")
file.name <- dir(fpath)
speech <- c()
for (j in file.name){
location <- paste("../data/InauguralSpeeches/", j, sep = "")
speech[j] <- paste(readLines(location, n=-1, skipNul=TRUE), collapse=" ")
}
inaug.speech <- data.frame(file.name, speech, stringsAsFactors = FALSE)
rownames(inaug.speech) <- NULL
substr.func <- function(df){
return(substr(df[1], start = 6, stop = nchar(df[1])-4))
}
inaug.speech$file.name <- apply(inaug.speech, 1, substr.func)
paste.func <- function(df){
return(paste(df[2], "-", df[3], sep = ""))
}
inaug.info$file.name <- apply(inaug.info, 1, paste.func)
inaug <- merge(x = inaug.info, y = inaug.speech, by.x = "file.name", by.y = "file.name")
inaug$speech <- strsplit(inaug$speech, split = '\\s')
View(inaug)
length(inaug$speech[[1]])
?read.table
inaug.dates <- read.table("../data/InauguationDates.txt", stringsAsFactors = FALSE, fill = TRUE)
View(inaug.dates)
inaug.dates <- read.table("../data/InauguationDates.txt", sep = ",", stringsAsFactors = FALSE, fill = TRUE)
inaug.dates <- read.table("../data/InauguationDates.txt", sep = ",", stringsAsFactors = FALSE, fill = TRUE)
